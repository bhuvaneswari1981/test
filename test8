Check Batch Job Instance Types
Look for Batch Job Submissions with Instance Type Details:
sqlSELECT 
    eventTime,
    eventName,
    userIdentity.userName,
    requestParameters,
    responseElements
FROM cloudtrial_audit_logging_prod
WHERE eventSource = 'batch.amazonaws.com'
    AND eventName IN ('SubmitJob', 'CreateJobQueue', 'CreateComputeEnvironment')
    AND eventTime >= CURRENT_DATE - INTERVAL '30' DAY
ORDER BY eventTime DESC;
Extract Instance Type Information from Request Parameters:
sqlSELECT 
    eventTime,
    eventName,
    JSON_EXTRACT_SCALAR(requestParameters, '$.computeEnvironmentName') as compute_env,
    JSON_EXTRACT_SCALAR(requestParameters, '$.computeResources.instanceTypes[0]') as instance_type,
    CASE 
        WHEN JSON_EXTRACT_SCALAR(requestParameters, '$.computeResources.instanceTypes[0]') LIKE 'c%' 
        THEN 'C-Series' 
        ELSE 'Other' 
    END as instance_family,
    requestParameters
FROM cloudtrial_audit_logging_prod
WHERE eventSource = 'batch.amazonaws.com'
    AND eventName = 'CreateComputeEnvironment'
    AND eventTime >= CURRENT_DATE - INTERVAL '90' DAY
ORDER BY eventTime DESC;
Check for Any C-Series Instance Usage:
sqlSELECT 
    DATE(eventTime) as date,
    eventName,
    COUNT(*) as total_events,
    COUNT(CASE 
        WHEN requestParameters LIKE '%"c[0-9]%' 
        OR requestParameters LIKE '%"c5%'
        OR requestParameters LIKE '%"c6%' 
        THEN 1 
    END) as c_series_count
FROM cloudtrial_audit_logging_prod
WHERE eventSource = 'batch.amazonaws.com'
    AND eventName IN ('CreateComputeEnvironment', 'UpdateComputeEnvironment')
    AND eventTime >= CURRENT_DATE - INTERVAL '90' DAY
GROUP BY DATE(eventTime), eventName
ORDER BY date DESC;
Alternative Approach - Check EC2 Instance Launches
Since Batch uses EC2 instances under the hood, you can also check EC2 launch events:
sqlSELECT 
    eventTime,
    eventName,
    JSON_EXTRACT_SCALAR(requestParameters, '$.instanceType') as instance_type,
    JSON_EXTRACT_SCALAR(requestParameters, '$.imageId') as ami_id,
    CASE 
        WHEN JSON_EXTRACT_SCALAR(requestParameters, '$.instanceType') LIKE 'c%' 
        THEN 'C-Series' 
        ELSE 'Other' 
    END as instance_family
FROM cloudtrial_audit_logging_prod
WHERE eventSource = 'ec2.amazonaws.com'
    AND eventName = 'RunInstances'
    AND (
        requestParameters LIKE '%batch%' 
        OR userAgent LIKE '%batch%'
        OR JSON_EXTRACT_SCALAR(requestParameters, '$.tagSpecification') LIKE '%batch%'
    )
    AND eventTime >= CURRENT_DATE - INTERVAL '30' DAY
ORDER BY eventTime DESC;
Summary Query for Instance Type Distribution
sqlWITH instance_usage AS (
    SELECT 
        JSON_EXTRACT_SCALAR(requestParameters, '$.computeResources.instanceTypes[0]') as instance_type,
        COUNT(*) as usage_count
    FROM cloudtrial_audit_logging_prod
    WHERE eventSource = 'batch.amazonaws.com'
        AND eventName = 'CreateComputeEnvironment'
        AND eventTime >= CURRENT_DATE - INTERVAL '90' DAY
        AND JSON_EXTRACT_SCALAR(requestParameters, '$.computeResources.instanceTypes[0]') IS NOT NULL
    GROUP BY JSON_EXTRACT_SCALAR(requestParameters, '$.computeResources.instanceTypes[0]')
)
SELECT 
    instance_type,
    usage_count,
    CASE 
        WHEN instance_type LIKE 'c%' THEN 'C-Series (Compute Optimized)'
        WHEN instance_type LIKE 'm%' THEN 'M-Series (General Purpose)'
        WHEN instance_type LIKE 'r%' THEN 'R-Series (Memory Optimized)'
        WHEN instance_type LIKE 't%' THEN 'T-Series (Burstable)'
        ELSE 'Other'
    END as instance_family
FROM instance_usage
ORDER BY usage_count DESC;



